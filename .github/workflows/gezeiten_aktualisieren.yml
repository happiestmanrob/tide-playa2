name: ğŸŒŠ Gezeiten automatisch aktualisieren und verÃ¶ffentlichen

on:
  schedule:
    - cron: "0 6 * * *" # Jeden Tag um 06:00 UTC automatisch
  workflow_dispatch:      # Manuell startbar im Actions-Tab

jobs:
  update-and-deploy:
    runs-on: ubuntu-latest

    steps:
      # ======================================================
      # ğŸ§© Repository klonen (damit GitHub Zugriff auf Dateien hat)
      # ======================================================
      - name: ğŸ”„ Repository klonen
        uses: actions/checkout@v4

      # ======================================================
      # ğŸ Python installieren (fÃ¼r update_tides.py)
      # ======================================================
      - name: ğŸ Python installieren
        uses: actions/setup-python@v5
        with:
          python-version: "3.x"

      # ======================================================
      # ğŸ“¦ Python-Bibliotheken installieren
      # ======================================================
      - name: ğŸ“¦ Bibliotheken fÃ¼r Python installieren
        run: pip install requests beautifulsoup4

      # ======================================================
      # ğŸŒŠ Gezeiten abrufen (Python-Script ausfÃ¼hren)
      # ======================================================
      - name: ğŸŒŠ Gezeiten aktualisieren (update_tides.py)
        run: python skripts/update_tides.py

      # ======================================================
      # âš™ï¸ Node.js installieren (fÃ¼r Frontend-Build)
      # ======================================================
      - name: âš™ï¸ Node.js installieren
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      # ======================================================
      # ğŸ“¦ AbhÃ¤ngigkeiten installieren (z. B. Puppeteer)
      # ======================================================
      - name: ğŸ“¦ Node-AbhÃ¤ngigkeiten installieren
        run: |
          echo "ğŸ“¦ Installiere npm-AbhÃ¤ngigkeiten..."
          npm install

      # ======================================================
      # ğŸ—‚ Frontend & Daten vorbereiten
      # ======================================================
      - name: ğŸ—‚ Frontend und Daten in /public kopieren
        run: |
          echo "ğŸ“‚ Kopiere Frontend-Dateien und aktualisierte Gezeiten-Daten..."
          mkdir -p public/data
          cp -r frontend/* public/
          cp -r data/latest.json public/data/latest.json

      # ======================================================
      # âœ… ÃœberprÃ¼fen, ob alle wichtigen Dateien vorhanden sind
      # ======================================================
      - name: âœ… ÃœberprÃ¼fe Ausgabe
        run: |
          echo "ğŸ” ÃœberprÃ¼fe erzeugte Dateien..."
          ls -R public
          test -f public/index.html || (echo "âŒ index.html fehlt!" && exit 1)
          test -f public/data/latest.json || (echo "âŒ latest.json fehlt!" && exit 1)

      # ======================================================
      # ğŸš€ Automatisch auf GitHub Pages verÃ¶ffentlichen
      # ======================================================
      - name: ğŸš€ VerÃ¶ffentlichen auf GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
