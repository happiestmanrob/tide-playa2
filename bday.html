<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Happy Birthday! üéâ</title>
<style>
  html,body {
    margin:0; height:100%; overflow:hidden;
    background:#0b0c10; color:#fff;
    font-family:system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial;
  }
  .center-screen {
    position:fixed; inset:0; display:grid; place-items:center; text-align:center;
    background: radial-gradient(1000px 700px at 50% 50%, #1b1d2b 0%, #0b0c10 70%);
  }
  h1 { font-size:clamp(2rem,6vw,5rem); margin:.3em 0; }
  .hb-btn {
    border:none; border-radius:999px;
    padding:1rem 1.8rem; font-size:1.3rem; font-weight:bold;
    background:#f9d649; color:#000; cursor:pointer;
    box-shadow:0 8px 20px rgba(249,214,73,.3);
    transition:transform .1s ease;
  }
  .hb-btn:hover { transform:scale(1.05); }

  #message {
    position:fixed; inset:0; display:flex; justify-content:center; align-items:center;
    font-size:clamp(1.5rem,4vw,3rem); color:#fff;
    text-shadow:0 2px 12px rgba(0,0,0,.6);
    opacity:0; transition:opacity 1s ease; pointer-events:none; z-index:5;
  }
  #message.show { opacity:1; }

  #viewer { position:fixed; inset:0; background:#000; display:none; overflow:hidden; }
  .img-layer {
    position:absolute; top:50%; left:50%;
    transform-origin:center center;
    transform:translate(-50%,-50%) scale(1);
    touch-action:none;
  }
  #confettiCanvas { position:fixed; inset:0; pointer-events:none; }
</style>
</head>
<body>
<canvas id="confettiCanvas"></canvas>

<div id="intro" class="center-screen">
  <div>
    <h1>Happy Birthday üéâ</h1>
    <button id="goBtn" class="hb-btn">Los geht‚Äôs!</button>
  </div>
</div>

<div id="message">Alles Liebe zum 33. Geburtstag, mein Schatz! ‚ù§Ô∏è</div>

<div id="viewer">
  <div id="stage"></div>
</div>

<script>
(function(){
const goBtn=document.getElementById('goBtn');
const intro=document.getElementById('intro');
const message=document.getElementById('message');
const viewer=document.getElementById('viewer');
const stage=document.getElementById('stage');
const confettiCanvas=document.getElementById('confettiCanvas');
const ctx=confettiCanvas.getContext('2d');
let confetti=[],rafId;

function resize(){confettiCanvas.width=innerWidth;confettiCanvas.height=innerHeight;}
window.addEventListener('resize',resize);resize();
const COLORS=['#f9d649','#ff7ac3','#7afcff','#baffc9','#ffd6a5','#b28dff'];
function spawnConfetti(particles=400,duration=2500){
  const arr=[];
  for(let i=0;i<particles;i++){
    const ang=Math.random()*Math.PI*2,speed=2+Math.random()*4;
    arr.push({x:innerWidth/2,y:innerHeight/2,vx:Math.cos(ang)*speed,vy:Math.sin(ang)*speed-3,
      g:.08+Math.random()*.12,s:6+Math.random()*6,rot:Math.random()*Math.PI,vr:(Math.random()-.5)*0.25,
      color:COLORS[(Math.random()*COLORS.length)|0],shape:Math.random()<.5?'rect':'circ',life:duration});
  }
  return arr;
}
function renderConfetti(){
  ctx.clearRect(0,0,innerWidth,innerHeight);
  confetti.forEach(p=>{
    p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr; p.life-=16;
    ctx.save();ctx.translate(p.x,p.y);ctx.rotate(p.rot);
    ctx.fillStyle=p.color;
    if(p.shape==='rect')ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s*.6);
    else{ctx.beginPath();ctx.arc(0,0,p.s*0.45,0,Math.PI*2);ctx.fill();}
    ctx.restore();
  });
  confetti=confetti.filter(p=>p.life>0);
  if(confetti.length>0)rafId=requestAnimationFrame(renderConfetti);
}
function burstSequence(){
  let i=0;
  function next(){
    confetti.push(...spawnConfetti(450,3000));
    cancelAnimationFrame(rafId);
    renderConfetti();
    i++; if(i<3)setTimeout(next,1200);
  }
  next();
}

// ===== Viewer / Zoom =====
let imgEl=null,scale=1,minScale=1,maxScale=30,tx=0,ty=0;
function applyTransform(){
  if(!imgEl)return;
  imgEl.style.transform=`translate(-50%,-50%) scale(${scale})`;
}
function fitToScreen(){
  const rect=stage.getBoundingClientRect();
  const sX=(rect.width)/imgEl.naturalWidth;
  const sY=(rect.height)/imgEl.naturalHeight;
  minScale=Math.min(sX,sY);
}
function loadImage(){
  const img=new Image();
  img.src='photo.jpg'; img.className='img-layer';
  img.onload=()=>{
    stage.innerHTML=''; stage.appendChild(img); imgEl=img;
    fitToScreen();
    startZoomAnimation();
  };
  img.onerror=()=>alert('Konnte photo.jpg nicht laden!');
}
function startZoomAnimation(){
  scale=30;
  applyTransform();
  const targetScale=minScale;
  const duration=15000; // 15 Sekunden
  const startTime=performance.now();
  (function anim(t){
    const progress=Math.min(1,(t-startTime)/duration);
    scale=30-(30-targetScale)*progress;
    applyTransform();
    if(progress<1)requestAnimationFrame(anim);
  })(startTime);
}

// ===== Interaction =====
let pointers=new Map(),lastDist=0,drag=false,lastX=0,lastY=0;
stage.addEventListener('pointerdown',e=>pointers.set(e.pointerId,e));
stage.addEventListener('pointerup',e=>{pointers.delete(e.pointerId);if(pointers.size===0){drag=false;lastDist=0;}});
stage.addEventListener('pointermove',e=>{
  pointers.set(e.pointerId,e);
  if(!imgEl)return;
  if(pointers.size===1){
    const p=[...pointers.values()][0];
    if(!drag){drag=true;lastX=p.clientX;lastY=p.clientY;}
    else{tx+=(p.clientX-lastX);ty+=(p.clientY-lastY);lastX=p.clientX;lastY=p.clientY;imgEl.style.transform=`translate(${tx}px,${ty}px) scale(${scale}) translate(-50%,-50%)`;}
  }else if(pointers.size===2){
    const [p1,p2]=[...pointers.values()];
    const dx=p1.clientX-p2.clientX, dy=p1.clientY-p2.clientY;
    const dist=Math.hypot(dx,dy);
    if(lastDist){
      const factor=dist/lastDist;
      scale=Math.min(maxScale,Math.max(minScale,scale*factor));
      applyTransform();
    }
    lastDist=dist;
  }
});
stage.addEventListener('wheel',e=>{
  e.preventDefault();
  const factor=Math.exp(-e.deltaY*0.0015);
  scale=Math.min(maxScale,Math.max(minScale,scale*factor));
  applyTransform();
},{passive:false});
stage.addEventListener('dblclick',()=>{scale=minScale;tx=0;ty=0;applyTransform();});

// ===== Ablauf =====
goBtn.addEventListener('click',()=>{
  intro.style.display='none';
  message.classList.add('show');
  burstSequence();
  setTimeout(()=>{
    message.classList.remove('show');
    viewer.style.display='block';
    document.documentElement.requestFullscreen?.();
    loadImage();
  },5500);
});
})();
</script>
</body>
</html>
