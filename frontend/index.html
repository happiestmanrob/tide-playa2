<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gezeiten ¬∑ Playa del Ingl√©s üåä</title>

  <!-- Schriftarten -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">

  <!-- Neue externe CSS-Datei -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="tide-container">
    <!-- Gezeitenkarte -->
    <div class="card tide-table">
      <h1>Gezeiten ¬∑ Playa del Ingl√©s üåä</h1>
      <h2 id="date-display">‚Äì</h2>

      <div class="tide-icon" id="tide-icon">‚¨ÜÔ∏è</div>
      <div class="status" id="tide-status">Das Wasser steigt</div>
      <div class="next" id="next-high">n√§chstes Hochwasser um ‚Äì:‚Äì Uhr</div>

      <div class="buttons">
        <button id="btn-today" class="active">Heute</button>
        <button id="btn-tomorrow">Morgen</button>
        <button id="btn-after">√úbermorgen</button>
        <select id="date-select"></select>
      </div>

      <table>
        <thead>
          <tr>
            <th>Zeit</th>
            <th>Typ</th>
            <th>H√∂he (m)</th>
          </tr>
        </thead>
        <tbody id="tide-table"></tbody>
      </table>

      <footer id="footer-text">
        Quelle: tide-forecast.com <span>¬∑</span> Aktualisiert: ‚Äì
      </footer>
    </div>

   

    <!-- WEBCAM -->
  </div>

  <div class="webcam">
    <video id="beachcam"
           controls
           autoplay
           muted
           playsinline
           width="960"
           height="540"
           style="border-radius:20px; box-shadow:0 8px 25px rgba(0,0,0,0.18); background:#000;">
      Dein Browser unterst√ºtzt keine Video-Wiedergabe.
    </video>
    <div class="webcam-link">
      <a href="https://in2thebeach.es/webcam/13/playa-del-ingles-curva/"
         target="_blank" rel="noopener noreferrer">
        üå¥ Webcam: Playa del Ingl√©s ‚Äì Curva
      </a>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script>
const video = document.getElementById('beachcam');
const videoSrc = 'https://richtigerleben.de/proxy.php?url=https://camserver2.in2thebeach.es/streams/mozart2/index.m3u8';

if (video.canPlayType('application/vnd.apple.mpegurl')) {
  video.src = videoSrc;
} else if (Hls.isSupported()) {
  const hls = new Hls();
  hls.loadSource(videoSrc);
  hls.attachMedia(video);
  hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
}
</script>






    


<script>
const iframe = document.getElementById("webcam-frame");
const fallback = document.getElementById("webcam-fallback");
let loaded = false;

iframe.onload = () => (loaded = true);

setTimeout(() => {
  if (!loaded) {
    iframe.style.display = "none";
    fallback.style.display = "block";
  }
}, 5000);
</script>



  <script>
    /* Dein JavaScript bleibt exakt gleich ‚Äì keine √Ñnderung n√∂tig */
    let activeIndex = 0;

    async function loadTideData() {
      try {
        const basePath = window.location.pathname.replace(/\/$/, "");
        const response = await fetch(`${basePath}/data/latest.json`);
        if (!response.ok) throw new Error("Fehler beim Laden der JSON-Datei.");
        const data = await response.json();
        if (!data.days?.length) throw new Error("Keine Daten gefunden.");
        window.tideData = data.days;
        const todayIndex = findTodayIndex(data.days);
        populateDateSelect(data.days);
        showDay(todayIndex);
      } catch (err) {
        document.getElementById("tide-table").innerHTML =
          `<tr><td colspan="3" class="error">‚ùå ${err.message}</td></tr>`;
      }
    }

    function findTodayIndex(days) {
      const todayStr = new Date().toISOString().split("T")[0];
      const index = days.findIndex((d) => d.date === todayStr);
      return index >= 0 ? index : 0;
    }

    function populateDateSelect(days) {
      const select = document.getElementById("date-select");
      select.innerHTML = "";
      days.forEach((d) => {
        const dateObj = new Date(d.date);
        const option = document.createElement("option");
        option.value = d.date;
        option.textContent = dateObj.toLocaleDateString("de-DE", {
          weekday: "long",
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
        });
        select.appendChild(option);
      });
      select.addEventListener("change", () => {
        const index = days.findIndex((d) => d.date === select.value);
        if (index !== -1) showDay(index);
      });
    }

    function formatTime(t) {
      const [h, m] = t.split(":").map(Number);
      return `${String(h).padStart(2, "0")}:${String(m).padStart(2, "0")}`;
    }

    function showDay(index) {
      activeIndex = index;
      updateButtons();

      const day = window.tideData[index];
      const dateObj = new Date(day.date);
      const now = new Date();
      const timeStr = now.toLocaleTimeString("de-DE", {
        hour: "2-digit",
        minute: "2-digit",
      });

      document.getElementById("date-display").textContent =
        dateObj.toLocaleDateString("de-DE", {
          weekday: "long",
          day: "numeric",
          month: "long",
          year: "numeric",
        }) + `, ${timeStr} Uhr`;

      document.getElementById("date-select").value = day.date;

      const tbody = document.getElementById("tide-table");
      tbody.innerHTML = "";
      day.tides.forEach((t) => {
        const tr = document.createElement("tr");
        tr.classList.add(t.typ === "Niedrigwasser" ? "low" : "high");
        tr.innerHTML = `
          <td>${formatTime(t.zeit)}</td>
          <td>${t.typ}</td>
          <td>${t.hoehe_m.toFixed(2)}</td>
        `;
        tbody.appendChild(tr);
      });

      updateStatus(day);
    }

    function updateButtons() {
      const todayIndex = findTodayIndex(window.tideData);
      document.getElementById("btn-today").classList.toggle("active", activeIndex === todayIndex);
      document.getElementById("btn-tomorrow").classList.toggle("active", activeIndex === todayIndex + 1);
      document.getElementById("btn-after").classList.toggle("active", activeIndex === todayIndex + 2);
    }

    function updateStatus(day) {
      const now = new Date();
      const nowMinutes = now.getHours() * 60 + now.getMinutes();
      const todayISO = new Date().toISOString().split("T")[0];
      const selectedDateISO = day.date;
      const allDays = window.tideData;
      const idx = allDays.findIndex((d) => d.date === selectedDateISO);

      const toMinutes = (t) => {
        const [h, m] = t.split(":").map(Number);
        return h * 60 + m;
      };

      let lastTide = null;
      let nextTide = null;
      for (const tide of day.tides) {
        const mins = toMinutes(tide.zeit);
        if (mins <= nowMinutes) lastTide = tide;
        if (mins > nowMinutes && !nextTide) nextTide = tide;
      }
      if (!nextTide && allDays[idx + 1]) nextTide = allDays[idx + 1].tides[0];

      let trendUp;
      let trendText;

      if (selectedDateISO === todayISO) {
        trendUp = nextTide?.typ === "Hochwasser";
        trendText = trendUp ? "Das Wasser steigt gerade" : "Das Wasser f√§llt gerade";
      } else {
        trendUp = (lastTide?.typ === "Niedrigwasser") || (nextTide?.typ === "Hochwasser");
        trendText = trendUp ? "Das Wasser steigt dann" : "Das Wasser f√§llt dann";
      }

      document.getElementById("tide-status").textContent = trendText;
      document.getElementById("tide-status").className = trendUp ? "status up" : "status down";
      document.getElementById("tide-icon").textContent = trendUp ? "‚¨ÜÔ∏è" : "‚¨áÔ∏è";
      if (nextTide) {
        document.getElementById("next-high").textContent =
          `n√§chstes ${nextTide.typ} um ${formatTime(nextTide.zeit)} Uhr`;
      }

      const updated = new Date().toLocaleString("de-DE", {
        timeZone: "Atlantic/Canary",
        hour: "2-digit",
        minute: "2-digit",
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
      });
      document.getElementById("footer-text").innerHTML =
        `Quelle: tide-forecast.com <span>¬∑</span> Aktualisiert: ${updated} WET`;
    }

    document.getElementById("btn-today").onclick = () => showDay(findTodayIndex(window.tideData));
    document.getElementById("btn-tomorrow").onclick = () => showDay(findTodayIndex(window.tideData) + 1);
    document.getElementById("btn-after").onclick = () => showDay(findTodayIndex(window.tideData) + 2);

    loadTideData();
  </script>
</body>
</html>
